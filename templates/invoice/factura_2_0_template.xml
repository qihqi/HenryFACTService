<?xml version="1.0" encoding="UTF-8"?>
<factura id="comprobante" version="1.1.0">
    <infoTributaria>
        <ambiente>{{ ambiente }}</ambiente> <!-- prueba 1, prod 2 -->
        <tipoEmision>1</tipoEmision>  <!-- always 1 -->
        <razonSocial>{{ razon_social }}</razonSocial> <!-- quinal sa etc -->
        <ruc>{{ ruc }}</ruc>
        <claveAcceso>{{ clave_acceso }}</claveAcceso>
        <codDoc>01</codDoc> <!-- 01 = Factura -->
        <estab>001</estab>
        <ptoEmi>001</ptoEmi>
        <secuencial>{{ codigo }}</secuencial>  <!-- esto es codigo de factura -->
        <dirMatriz>{{ strip_accents(dir_matriz) }}</dirMatriz>
    </infoTributaria>
    <infoFactura>
        <fechaEmision>{{ fecha }}</fechaEmision> <!-- dd/mm/aaaa -->
        <!-- ruc = 04 , cedula = 05, final = 07--> 
        <tipoIdentificacionComprador>{{ tipo_identificacion_comprador }}</tipoIdentificacionComprador> <!-- numero cedula -->
        <razonSocialComprador>{{ strip_accents(razon_social_comprador) }}</razonSocialComprador>
        <identificacionComprador>{{ id_comprador }}</identificacionComprador>
        <totalSinImpuestos>{{ subtotal }}</totalSinImpuestos>
        <totalDescuento>{{ descuento }}</totalDescuento>
        <totalConImpuestos>
            <totalImpuesto>
                <codigo>2</codigo>  <!-- iva = 2 -->
                <codigoPorcentaje>{{ 2 if tax_percent == 12 else 3 }}</codigoPorcentaje> <!-- 2 = 12%, 3 = 14% -->
                <baseImponible> {{  '%0.2f' % subtotal }}</baseImponible>
                <valor>{{  '%0.2f' % iva }}</valor>
            </totalImpuesto>
        </totalConImpuestos>
        <importeTotal>{{ total }} </importeTotal>
        <moneda> DOLAR </moneda>
        <pagos>
            <pago>
                <formaPago>01</formaPago>
                <total>{{total}}</total>
            </pago>
        </pagos>
    </infoFactura>
    <detalles>
        {% for d in detalles %}
        <detalle>
            <codigoPrincipal>{{d.id}}</codigoPrincipal>
            <descripcion> {{ strip_accents(d.nombre) }}</descripcion>
            <cantidad>{{ d.cantidad }}</cantidad>
            <precioUnitario>{{  "%.2f" |format( d.precio) }}</precioUnitario>
            <descuento>
                {{  "%.2f" |format(d.descuento) }}
            </descuento>
            <precioTotalSinImpuesto>
                {{ "%.2f" |format(d.total_sin_impuesto) }}
            </precioTotalSinImpuesto>
            <impuestos>
                <impuesto>
                    <codigo>2</codigo> <!-- 2 = IVA -->
                    <codigoPorcentaje>{{ 2 if tax_percent == 12 else 3 }}</codigoPorcentaje> <!-- 2 = 12%, 3 = 14% -->
                    <tarifa>{{ tax_percent }}</tarifa>
                    <baseImponible>{{ '%.2f'|format(d.total_sin_impuesto) }}</baseImponible>
                    <valor>{{  '%.2f'|format( d.total_impuesto) }}</valor>
                </impuesto>
            </impuestos>
        </detalle>
        {% endfor %}
    </detalles>
</factura>
