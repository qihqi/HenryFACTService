<html>
    <head>
        <!-- 
            
                <p> 1 POLICENTRO </p>
            
        -->
        <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script>
            var config = {
                api : 'http://localhost:8080/api'
            };
        </script>
        <script>
                function is_number(b) {
                    return b!=undefined && b!=null && (b - 0) == b;
                }
                function popup(){
                    var newwindow=window.open("/static/buscar_producto.html",'name','height=700,width=500, scrollbars=yes');
                    window.codigo_click = $(this).attr("id");
                    if (window.focus) {
                        newwindow.focus();
                    }
                    return false;
                }
                function getProdAjaxCall(codigo, callback) {
                    var url = config.api + '/producto/' + codigo;
                    $.ajax({
                        url: url,
                        success: function(result) {
                            var result = JSON.parse(result);
                            callback(result);
                        },
                        failure: function(result) {
                            callback(false);
                        }
                    });
                }


                var count=0;
                function getRow() {
                    var p = $("<tr>");
                    var codigo_cell = $("<td>");
                    var cant_cell = $("<td>");
                    var nombre_cell = $("<td>");
                    var buscar_cell = $("<td>");
                    var trans_cell = $("<td>");
                    var codigo = $("<input id=\"here"+ count + "\" name=\"codigo\" class=\"text_field\">");
                    var cant = $("<input id=\"here"+ count + "\" name=\"cant\" class=\"text_field\">");
                    var nombre = $("<span id=\"here"+ count + "\" name=\"nombre\" class=\"text_field\">");
                    var buscar = $("<a id=\"here"+ count + "\" name=\"nombre\" href=\"\" class=\"text_field\" >");
                   // var trans = $("<input id=\"here"+ count + "\" name=\"transform\" class=\"text_field\" type=\"checkbox\">");
                    buscar.click(popup);
                    buscar.html("buscar"); 
                    codigo_cell.append(codigo);
                    cant_cell.append(cant);
                    nombre_cell.append(nombre);
                    buscar_cell.append(buscar);
                    //trans_cell.append(trans);
                    p.append(buscar_cell, codigo_cell, cant_cell, nombre_cell);

                    codigo.keypress(function(event) { 
                        if (event.which == 13){
                            event.preventDefault();
                            var id = $(this).attr("id");
                            var dest = $("span#"+id);
                            var codigo = $(this).val();
                            getProdAjaxCall(codigo, function(result) {
                                if (result) {
                                    dest.html(result.nombre);
                                    cant.focus();
                                } else {
                                    dest.html("Codigo Equivocado");
                                    $(this).select();
                                }
                            });
                        }
                    });

                    cant.keypress(function(event) {
                        if (event.which == 13) {
                            event.preventDefault();
                            
                            var number = $(this).val();
                            if (! is_number(number)) { 
                                alert("cantidad debe ser numero");
                                return;
                            }

                            var a = getRow();
                            $("#insert").append(a);
                            a.beginning.focus();

                        }
                    });
                    count++;
                    p.beginning = codigo;
                    return p;
                }
        </script>
        <script type="text/javascript">
            
            $(document).ready(function(){
                var a = getRow();
                $("#insert").append(a);
            });
        </script>
        <style>
            input.text_field { width : 100px }
        </style>
    </head>
    <body>
    <button onClick="window.location='/r';" > Regresar </button>
    <form id="p" method="post" action="/r/producto/ingreso">
        <input type="submit" value="Guardar"/>
        <p> Bodega: 
        <select id="id_bodega" name="bodega">
            <option value="1"> POLICENTRO </option> 
        </select>
            </p>
            <table id="insert" cellspacing="10px">
                <tr>
                    <td></td>
                    <th> Codigo </th>
                    <th> Cantidad </th>
                    <th> Nombre de Producto </th>
                </tr>
            </table> 
        </form>
    </body>
</html>
